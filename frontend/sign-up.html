<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>

    <title>Inscription</title>
    <link rel="shortcut icon" href="https://firebasestorage.googleapis.com/v0/b/lasmo-dcd6a.appspot.com/o/logo.png?alt=media&token=2eea40dc-3a50-4853-ac58-064bf597525f" type="image/x-icon">
    <!-- CSS files -->
    <link href="./dist/css/tabler.min.css?1684106062" rel="stylesheet"/>
    <link href="./dist/css/tabler-flags.min.css?1684106062" rel="stylesheet"/>
    <link href="./dist/css/tabler-payments.min.css?1684106062" rel="stylesheet"/>
    <link href="./dist/css/tabler-vendors.min.css?1684106062" rel="stylesheet"/>
    <link href="./dist/css/demo.min.css?1684106062" rel="stylesheet"/>
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
      	font-feature-settings: "cv03", "cv04", "cv11";
      }
    </style>
  </head>
  <body  class=" d-flex flex-column">
    <script src="./dist/js/demo-theme.min.js?1684106062"></script>
    <div class="page page-center">
      <div class="container container-tight py-4">
        <div class="text-center mb-4">
          <a href="." class="navbar-brand navbar-brand-autodark"><img src="./assets/images/logo.png" height="36" alt=""></a>
        </div>

        <form class="card card-md" novalidate>
          <div class="card-body">
            <h2 class="card-title text-center mb-4">S'inscrire</h2>
            
            <div class="input-icon mb-3">
              <span class="input-icon-addon">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /></svg>
              </span>
              <input id="lastname" type="text" value="" class="form-control" placeholder="Nom">
            </div>
            
            <div class="input-icon mb-3">
              <span class="input-icon-addon">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /></svg>
              </span>
              <input id="firstname" type="text" value="" class="form-control" placeholder="Prénoms">
            </div>

            <div class="mb-3">
              <label class="form-label">Address mail</label>
              <input id="email" type="email" class="form-control" placeholder="Entrer email">
            </div>
            
            <div class="mb-3">
              <label class="form-label">Mot de passe</label>
              <div class="input-group input-group-flat">
                <input id="password1" type="password" class="form-control"  placeholder="mot de passe"  autocomplete="off">
                <span class="input-group-text">
                  <a href="#" id="password1Show" class="link-secondary" title="Montrer mot de passe" data-bs-toggle="tooltip">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
                  </a>
                </span>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Confirmez Mot de passe</label>
              <div class="input-group input-group-flat">
                <input id="password2" type="password" class="form-control"  placeholder="mot de passe"  autocomplete="off">
                <span class="input-group-text">
                  <a href="#"  id="password2Show" class="link-secondary" title="Montrer mot de passe" data-bs-toggle="tooltip">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
                  </a>
                </span>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-4">
                <div class="mb-6">
                  <label class="form-label">Code</label>
                  <select class="form-select" id="country-code-select">
                    <option value="229">Bénin (+229)</option>
                    <option value="226">Burkina Faso (+226)</option>
                    <option value="257">Burundi (+257)</option>
                    <option value="238">Cap-Vert (+238)</option>
                    <option value="225">Côte d'Ivoire (+225)</option>
                    <option value="220">Gambie (+220)</option>
                    <option value="233">Ghana (+233)</option>
                    <option value="224">Guinée (+224)</option>
                    <option value="245">Guinée-Bissau (+245)</option>
                    <option value="231">Liberia (+231)</option>
                    <option value="223">Mali (+223)</option>
                    <option value="222">Mauritanie (+222)</option>
                    <option value="234">Niger (+234)</option>
                    <option value="234">Nigeria (+234)</option>
                    <option value="221">Sénégal (+221)</option>
                    <option value="232">Sierra Leone (+232)</option>
                    <option value="228">Togo (+228)</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="mb-3">
                  <label class="form-label">telephone</label>
                  <input id="numero_tel" type="text" class="form-control">
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Votre status</label>
              <div class="btn-group w-100"role="group">
                <input type="radio" class="btn-check" name="btn-radio-basic" id="btn-radio-basic-1" value="etudiant" autocomplete="off" >
                <label for="btn-radio-basic-1" type="button" class="btn">Etudiant</label>
                <input type="radio" class="btn-check" name="btn-radio-basic" id="btn-radio-basic-2" value="entreprise" autocomplete="off">
                <label for="btn-radio-basic-2" type="button" class="btn">Entreprise</label>
                <input type="radio" class="btn-check" name="btn-radio-basic" id="btn-radio-basic-3" value="particulier" autocomplete="off">
                <label for="btn-radio-basic-3" type="button" class="btn">Particulier</label>
              </div>
            </div>
            <!-- <button id="get-value-button">Obtenir la valeur sélectionnée</button> -->
            <!-- <p id="selected-value">Valeur sélectionnée : <span></span></p>  -->
            <div class="mb-3">
              <label class="form-check">
                <input type="checkbox" class="form-check-input"/>
                <span class="form-check-label">Je suis d'accord avec les<a href="./terms-of-service.html" tabindex="-1"> termes et politiques</a>.</span>
              </label>
            </div>
            <div class="form-footer">
              <button id="registerButton" class="btn btn-primary w-100">S'inscrire</button>
            </div>
          </div>
        </form>
        <div class="text-center text-muted mt-3">
          Vous avez déjà un compte ?<a href="/login" tabindex="-1">Connectez-vous !</a>
        </div>
      </div>
    </div>
    <!-- Libs JS -->
    <!-- Tabler Core -->
    <script src="./dist/js/tabler.min.js?1684106062" defer></script>
    <script src="./dist/js/demo.min.js?1684106062" defer></script>
    <!-- Axios Libs -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      

    <script>
      document.getElementById('password1Show').addEventListener('click', (e) => {
        e.preventDefault();
        var password1Input = document.getElementById('password1');

        password1Input.type === 'password' ? password1Input.type = 'text' : password1Input.type = 'password';

      });
      document.getElementById('password2Show').addEventListener('click', function (e) {
        e.preventDefault();
        var password2Input = document.getElementById('password2');

        password2Input.type === 'password' ? password2Input.type = 'text' : password2Input.type = 'password';

      });
    </script>


      <script>
        function WhichBoxChecked () {
          const radios = document.querySelectorAll('input[name="btn-radio-basic"]');
          let selectedValue = null;
          for (const radio of radios) {
            if (radio.checked) {
              selectedValue = radio.value;
             
              break;
            }
          }
          return selectedValue
        }

        function getCodeCountrySelectedValue(selectId) {
          const selectElement = document.getElementById(selectId);
          if (selectElement) {
            return selectElement.value;
          } else {
            console.error(`Element with ID ${selectId} not found.`);
            return null;
          }
        }
        function getCurrentDateISO() {
          const now = new Date();
          return now.toISOString();
        }

        document.addEventListener("DOMContentLoaded", () => {
          const todayISO = getCurrentDateISO();
          console.log(todayISO);  
                
        })
       


      const registerButton = document.getElementById("registerButton");
          

      registerButton.addEventListener("click", async function (e) {

        e.preventDefault();
        const firstname = document.getElementById("firstname").value;
        const lastname = document.getElementById("lastname").value;
        const email = document.getElementById("email").value;
        const country_code = getCodeCountrySelectedValue('country-code-select');
        const numero_tel = document.getElementById('numero_tel').value;
        const TodayDate = new Date()
        const user_category = WhichBoxChecked();
        const todayISODate = getCurrentDateISO();



        const password1 = document.getElementById("password1").value;
        const password2 = document.getElementById("password2").value;


        // Vérifier si les champs email et password ne sont pas vides
        if (!email || !password1) {
          alert("Veuillez saisir votre nom d'utilisateur et votre mot de passe.");
          return;
        }
        //
        InformalData = {
                  
            firstname :firstname ,
            lastname: lastname, 
            email: email, 
            country_code: country_code, 
            numero_tel: numero_tel, 
            date_inscription: todayISODate, 
            user_category: user_category, 
            type_user: 'simple'

        }
        try {
          UserFinalFormaliseResponse = await axios.post("/formalise", InformalData)

          UserFinalFormalise = UserFinalFormaliseResponse.data;

          try {
                  // Envoyer les données informelles pour formaliser la réponse
                  const UserFinalFormaliseResponse = await axios.post("/formalise", InformalData);
                  const UserFinalFormalise = UserFinalFormaliseResponse.data;

                  try {
                    // Envoyer les données d'inscription
                    const registerResponse = await axios.post("/register", {
                      firstname: UserFinalFormalise.firstname,
                      lastname: UserFinalFormalise.lastname,
                      email: UserFinalFormalise.email,
                      password: password1, 
                      password2: password2,
                      country_code: UserFinalFormalise.country_code,
                      numero_tel: UserFinalFormalise.numero_tel,
                      date_inscription: UserFinalFormalise.date_inscription,
                      date_paiement: UserFinalFormalise.date_paiement,
                      amount_to_pay: UserFinalFormalise.amount_to_pay,
                      user_category: UserFinalFormalise.user_category,
                      type_user: UserFinalFormalise.type_user,
                      // duree_abonnement: UserFinalFormalise.duree_abonnement
                      duree_abonnement: 0

                    });

                    console.log("Inscription réussie :", registerResponse);
                    window.location.href = "/login";
                  } catch (registerError) {
                    console.error("Erreur lors de la création du compte :", registerError);
                    alert("Erreur lors de la création du compte, veuillez réessayer.");
                  }
                } catch (formaliseError) {
                  console.error("Erreur lors de la formalisation des données :", formaliseError);
                  alert("Erreur lors de la formalisation des données, veuillez réessayer.");
                }

        } catch (error) {
          console.error("Erreur lors de la formalisation des données :", formaliseError);
          alert("Erreur lors de la formalisation des données, veuillez réessayer.");
        }

      });
   
    </script>
  
  </body>
</html>